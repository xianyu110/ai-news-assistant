import{d as e,r as s,c as a,o as l,g as t,f as c,w as o,i as r,h as u,j as n,k as i,l as f,I as d,n as g,m as _,q as v,F as y,u as h,t as p,S as k,x as m,s as C,z as w,H as L,J as T,A as x,y as $}from"./index-Bp6ppwUO.js";import{N as b,_ as M}from"./_plugin-vue_export-helper.DIRIpgiM.js";const A=M(e({__name:"search",setup(e){const M=s(""),A=s([]),I=s("全部"),z=s(!1),D=s(!1),H=s([]),j=s(["全部","投融资","开源项目","产品发布","行业动态","技术研究","综合资讯"]),V=s(["AI模型","大语言模型","ChatGPT","OpenAI","投融资","开源","谷歌","微软","百度","机器学习","深度学习","自然语言处理"]),E=a(()=>"全部"===I.value?A.value:A.value.filter(e=>e.category===I.value));l(()=>{R()});const N=()=>{},q=async()=>{const e=M.value.trim();if(e){z.value=!0,D.value=!0;try{console.log(`🔍 搜索关键词: ${e}`);const s=await b.getNews();if(!s.success)throw new Error(s.error||"搜索失败");{const a=s.data.filter(s=>{const a=s.title.toLowerCase().includes(e.toLowerCase()),l=s.content.toLowerCase().includes(e.toLowerCase()),t=s.tags&&s.tags.some(s=>s.toLowerCase().includes(e.toLowerCase())),c=s.source.toLowerCase().includes(e.toLowerCase());return a||l||t||c});A.value=a.sort((e,s)=>new Date(s.publishTime).getTime()-new Date(e.publishTime).getTime()),console.log(`✅ 找到 ${A.value.length} 条相关结果`),P(e)}}catch(s){console.error("❌ 搜索失败:",s),C({title:"搜索失败",icon:"error"})}finally{z.value=!1}}},F=e=>{M.value=e,q()},G=e=>{if(!M.value||!e)return e;const s=M.value.trim(),a=new RegExp(`(${s})`,"gi");return e.replace(a,'<span style="color: #007aff; background-color: #f0f8ff;">$1</span>')},J=()=>{M.value="",A.value=[],D.value=!1},O=()=>{L()},P=e=>{try{const s=[e,...H.value.filter(s=>s!==e)];H.value=s.slice(0,10),T("search_history",H.value)}catch(s){console.error("保存搜索历史失败:",s)}},R=()=>{try{const e=t("search_history");e&&Array.isArray(e)&&(H.value=e)}catch(e){console.error("加载搜索历史失败:",e)}},S=()=>{x({title:"提示",content:"确定要清空搜索历史吗？",success:e=>{e.confirm&&(H.value=[],$("search_history"),C({title:"已清空",icon:"success"}))}})},U=e=>{if(!e)return"";const s=new Date(e),a=(new Date).getTime()-s.getTime(),l=Math.floor(a/6e4),t=Math.floor(a/36e5),c=Math.floor(a/864e5);return l<60?`${l}分钟前`:t<24?`${t}小时前`:c<7?`${c}天前`:`${s.getMonth()+1}月${s.getDate()}日`};return(e,s)=>{const a=u("uni-icons"),l=d,t=r,C=g,L=k;return n(),c(t,{class:"search-container"},{default:o(()=>[i(t,{class:"search-header"},{default:o(()=>[i(t,{class:"search-input-box"},{default:o(()=>[i(a,{type:"search",size:"18",color:"#999"}),i(l,{class:"search-input",modelValue:M.value,"onUpdate:modelValue":s[0]||(s[0]=e=>M.value=e),placeholder:"搜索AI快讯...",onInput:N,onConfirm:q,focus:""},null,8,["modelValue"]),M.value?(n(),c(t,{key:0,class:"clear-btn",onClick:J},{default:o(()=>[i(a,{type:"clear",size:"16",color:"#999"})]),_:1})):f("",!0)]),_:1}),i(C,{class:"cancel-btn",onClick:O},{default:o(()=>[_("取消")]),_:1})]),_:1}),A.value.length||D.value?f("",!0):(n(),c(t,{key:0,class:"search-suggestions"},{default:o(()=>[i(t,{class:"suggestion-section"},{default:o(()=>[i(C,{class:"section-title"},{default:o(()=>[_("热门搜索")]),_:1}),i(t,{class:"suggestion-tags"},{default:o(()=>[(n(!0),v(y,null,h(V.value,e=>(n(),c(C,{key:e,class:"suggestion-tag",onClick:s=>F(e)},{default:o(()=>[_(p(e),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),H.value.length?(n(),c(t,{key:0,class:"suggestion-section"},{default:o(()=>[i(t,{class:"section-header"},{default:o(()=>[i(C,{class:"section-title"},{default:o(()=>[_("搜索历史")]),_:1}),i(C,{class:"clear-history",onClick:S},{default:o(()=>[_("清空")]),_:1})]),_:1}),i(t,{class:"suggestion-tags"},{default:o(()=>[(n(!0),v(y,null,h(H.value,e=>(n(),c(C,{key:e,class:"suggestion-tag history-tag",onClick:s=>F(e)},{default:o(()=>[_(p(e),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):f("",!0)]),_:1})),D.value?(n(),c(t,{key:1,class:"search-results"},{default:o(()=>[z.value?f("",!0):(n(),c(t,{key:0,class:"result-stats"},{default:o(()=>[i(C,{class:"stats-text"},{default:o(()=>[_(" 找到 "+p(A.value.length)+" 条相关结果 ",1),M.value?(n(),c(C,{key:0},{default:o(()=>[_("「"+p(M.value)+"」",1)]),_:1})):f("",!0)]),_:1})]),_:1})),i(t,{class:"filter-section"},{default:o(()=>[i(L,{"scroll-x":"true",class:"filter-scroll"},{default:o(()=>[i(t,{class:"filter-list"},{default:o(()=>[(n(!0),v(y,null,h(j.value,(e,s)=>(n(),c(t,{key:s,class:m(["filter-item",{active:I.value===e}]),onClick:s=>(e=>{I.value=e})(e)},{default:o(()=>[_(p(e),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),i(t,{class:"results-list"},{default:o(()=>[(n(!0),v(y,null,h(E.value,(e,s)=>(n(),c(t,{key:e.id,class:"result-item",onClick:s=>(e=>{w({url:`/pages/ai-news/news-detail?id=${e.id}`})})(e)},{default:o(()=>[i(t,{class:"result-header"},{default:o(()=>{return[i(t,{class:m(["result-category",(s=e.category,{"投融资":"category-finance","开源项目":"category-opensource","产品发布":"category-product","行业动态":"category-industry","技术研究":"category-tech","综合资讯":"category-general"}[s]||"category-default")])},{default:o(()=>[_(p(e.category),1)]),_:2},1032,["class"]),i(C,{class:"result-time"},{default:o(()=>[_(p(U(e.publishTime)),1)]),_:2},1024)];var s}),_:2},1024),i(t,{class:"result-title",innerHTML:G(e.title)},null,8,["innerHTML"]),i(t,{class:"result-content",innerHTML:G(e.content)},null,8,["innerHTML"]),e.tags&&e.tags.length?(n(),c(t,{key:0,class:"result-tags"},{default:o(()=>[(n(!0),v(y,null,h(e.tags.slice(0,3),e=>(n(),c(C,{key:e,class:"result-tag"},{default:o(()=>[_(p(e),1)]),_:2},1024))),128))]),_:2},1024)):f("",!0)]),_:2},1032,["onClick"]))),128)),z.value||0!==A.value.length?f("",!0):(n(),c(t,{key:0,class:"no-results"},{default:o(()=>[i(a,{type:"search",size:"60",color:"#ddd"}),i(C,{class:"no-results-text"},{default:o(()=>[_("没有找到相关内容")]),_:1}),i(C,{class:"no-results-tip"},{default:o(()=>[_("试试其他关键词")]),_:1})]),_:1}))]),_:1})]),_:1})):f("",!0),z.value?(n(),c(t,{key:2,class:"loading-state"},{default:o(()=>[i(a,{type:"spinner-cycle",size:"30",color:"#007aff"}),i(C,{class:"loading-text"},{default:o(()=>[_("搜索中...")]),_:1})]),_:1})):f("",!0)]),_:1})}}}),[["__scopeId","data-v-07bf3e98"]]);export{A as default};
