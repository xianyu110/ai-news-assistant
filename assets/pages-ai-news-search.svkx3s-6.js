import{d as e,r as s,c as a,o as l,E as t,f as c,w as o,i as r,g as u,h as n,j as i,k as f,I as d,m as g,l as _,n as v,F as y,p as h,t as p,S as k,u as m,s as C,x as w,D as L,G as T,y as x,H as $}from"./index-Cbaj6nl3.js";import{N as b,_ as M}from"./_plugin-vue_export-helper.DjZl1frK.js";const D=M(e({__name:"search",setup(e){const M=s(""),D=s([]),I=s("全部"),A=s(!1),H=s(!1),z=s([]),j=s(["全部","投融资","开源项目","产品发布","行业动态","技术研究","综合资讯"]),E=s(["AI模型","大语言模型","ChatGPT","OpenAI","投融资","开源","谷歌","微软","百度","机器学习","深度学习","自然语言处理"]),V=a(()=>"全部"===I.value?D.value:D.value.filter(e=>e.category===I.value));l(()=>{U()});const G=()=>{},N=async()=>{const e=M.value.trim();if(e){A.value=!0,H.value=!0;try{console.log(`🔍 搜索关键词: ${e}`);const s=await b.getNews();if(!s.success)throw new Error(s.error||"搜索失败");{const a=s.data.filter(s=>{const a=s.title.toLowerCase().includes(e.toLowerCase()),l=s.content.toLowerCase().includes(e.toLowerCase()),t=s.tags&&s.tags.some(s=>s.toLowerCase().includes(e.toLowerCase())),c=s.source.toLowerCase().includes(e.toLowerCase());return a||l||t||c});D.value=a.sort((e,s)=>new Date(s.publishTime).getTime()-new Date(e.publishTime).getTime()),console.log(`✅ 找到 ${D.value.length} 条相关结果`),S(e)}}catch(s){console.error("❌ 搜索失败:",s),C({title:"搜索失败",icon:"error"})}finally{A.value=!1}}},F=e=>{M.value=e,N()},O=e=>{if(!M.value||!e)return e;const s=M.value.trim(),a=new RegExp(`(${s})`,"gi");return e.replace(a,'<span style="color: #007aff; background-color: #f0f8ff;">$1</span>')},P=()=>{M.value="",D.value=[],H.value=!1},R=()=>{L()},S=e=>{try{const s=[e,...z.value.filter(s=>s!==e)];z.value=s.slice(0,10),T("search_history",z.value)}catch(s){console.error("保存搜索历史失败:",s)}},U=()=>{try{const e=t("search_history");e&&Array.isArray(e)&&(z.value=e)}catch(e){console.error("加载搜索历史失败:",e)}},q=()=>{x({title:"提示",content:"确定要清空搜索历史吗？",success:e=>{e.confirm&&(z.value=[],$("search_history"),C({title:"已清空",icon:"success"}))}})},B=e=>{if(!e)return"";const s=new Date(e),a=(new Date).getTime()-s.getTime(),l=Math.floor(a/6e4),t=Math.floor(a/36e5),c=Math.floor(a/864e5);return l<60?`${l}分钟前`:t<24?`${t}小时前`:c<7?`${c}天前`:`${s.getMonth()+1}月${s.getDate()}日`};return(e,s)=>{const a=u("uni-icons"),l=d,t=r,C=g,L=k;return n(),c(t,{class:"search-container"},{default:o(()=>[i(t,{class:"search-header"},{default:o(()=>[i(t,{class:"search-input-box"},{default:o(()=>[i(a,{type:"search",size:"18",color:"#999"}),i(l,{class:"search-input",modelValue:M.value,"onUpdate:modelValue":s[0]||(s[0]=e=>M.value=e),placeholder:"搜索AI快讯...",onInput:G,onConfirm:N,focus:""},null,8,["modelValue"]),M.value?(n(),c(t,{key:0,class:"clear-btn",onClick:P},{default:o(()=>[i(a,{type:"clear",size:"16",color:"#999"})]),_:1})):f("",!0)]),_:1}),i(C,{class:"cancel-btn",onClick:R},{default:o(()=>[_("取消")]),_:1})]),_:1}),D.value.length||H.value?f("",!0):(n(),c(t,{key:0,class:"search-suggestions"},{default:o(()=>[i(t,{class:"suggestion-section"},{default:o(()=>[i(C,{class:"section-title"},{default:o(()=>[_("热门搜索")]),_:1}),i(t,{class:"suggestion-tags"},{default:o(()=>[(n(!0),v(y,null,h(E.value,e=>(n(),c(C,{key:e,class:"suggestion-tag",onClick:s=>F(e)},{default:o(()=>[_(p(e),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),z.value.length?(n(),c(t,{key:0,class:"suggestion-section"},{default:o(()=>[i(t,{class:"section-header"},{default:o(()=>[i(C,{class:"section-title"},{default:o(()=>[_("搜索历史")]),_:1}),i(C,{class:"clear-history",onClick:q},{default:o(()=>[_("清空")]),_:1})]),_:1}),i(t,{class:"suggestion-tags"},{default:o(()=>[(n(!0),v(y,null,h(z.value,e=>(n(),c(C,{key:e,class:"suggestion-tag history-tag",onClick:s=>F(e)},{default:o(()=>[_(p(e),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):f("",!0)]),_:1})),H.value?(n(),c(t,{key:1,class:"search-results"},{default:o(()=>[A.value?f("",!0):(n(),c(t,{key:0,class:"result-stats"},{default:o(()=>[i(C,{class:"stats-text"},{default:o(()=>[_(" 找到 "+p(D.value.length)+" 条相关结果 ",1),M.value?(n(),c(C,{key:0},{default:o(()=>[_("「"+p(M.value)+"」",1)]),_:1})):f("",!0)]),_:1})]),_:1})),i(t,{class:"filter-section"},{default:o(()=>[i(L,{"scroll-x":"true",class:"filter-scroll"},{default:o(()=>[i(t,{class:"filter-list"},{default:o(()=>[(n(!0),v(y,null,h(j.value,(e,s)=>(n(),c(t,{key:s,class:m(["filter-item",{active:I.value===e}]),onClick:s=>(e=>{I.value=e})(e)},{default:o(()=>[_(p(e),1)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),i(t,{class:"results-list"},{default:o(()=>[(n(!0),v(y,null,h(V.value,(e,s)=>(n(),c(t,{key:e.id,class:"result-item",onClick:s=>(e=>{w({url:`/pages/ai-news/news-detail?id=${e.id}`})})(e)},{default:o(()=>[i(t,{class:"result-header"},{default:o(()=>{return[i(t,{class:m(["result-category",(s=e.category,{"投融资":"category-finance","开源项目":"category-opensource","产品发布":"category-product","行业动态":"category-industry","技术研究":"category-tech","综合资讯":"category-general"}[s]||"category-default")])},{default:o(()=>[_(p(e.category),1)]),_:2},1032,["class"]),i(C,{class:"result-time"},{default:o(()=>[_(p(B(e.publishTime)),1)]),_:2},1024)];var s}),_:2},1024),i(t,{class:"result-title",innerHTML:O(e.title)},null,8,["innerHTML"]),i(t,{class:"result-content",innerHTML:O(e.content)},null,8,["innerHTML"]),e.tags&&e.tags.length?(n(),c(t,{key:0,class:"result-tags"},{default:o(()=>[(n(!0),v(y,null,h(e.tags.slice(0,3),e=>(n(),c(C,{key:e,class:"result-tag"},{default:o(()=>[_(p(e),1)]),_:2},1024))),128))]),_:2},1024)):f("",!0)]),_:2},1032,["onClick"]))),128)),A.value||0!==D.value.length?f("",!0):(n(),c(t,{key:0,class:"no-results"},{default:o(()=>[i(a,{type:"search",size:"60",color:"#ddd"}),i(C,{class:"no-results-text"},{default:o(()=>[_("没有找到相关内容")]),_:1}),i(C,{class:"no-results-tip"},{default:o(()=>[_("试试其他关键词")]),_:1})]),_:1}))]),_:1})]),_:1})):f("",!0),A.value?(n(),c(t,{key:2,class:"loading-state"},{default:o(()=>[i(a,{type:"spinner-cycle",size:"30",color:"#007aff"}),i(C,{class:"loading-text"},{default:o(()=>[_("搜索中...")]),_:1})]),_:1})):f("",!0)]),_:1})}}}),[["__scopeId","data-v-07bf3e98"]]);export{D as default};
