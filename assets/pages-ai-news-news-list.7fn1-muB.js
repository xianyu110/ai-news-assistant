import{d as e,r as a,c as t,o as s,a as l,b as n,e as c,s as o,f as u,w as r,i,g as d,h as f,j as v,k as g,l as _,m as h,t as w,n as y,F as p,p as m,q as b,u as k,v as C,x as D,y as F}from"./index-Byj_NXLU.js";import{N as $,L as T,_ as I}from"./_plugin-vue_export-helper.CgG7HaQr.js";const S=I(e({__name:"news-list",setup(e){const I=a(!1),S=a(!1),x=a([]),A=a({totalCount:0,todayCount:0,categories:[],sources:[]}),z=a(Date.now()),M=a(1),j=a(20),E=a(!0),N=a(null),O=a(!0),B=t(()=>{const e={};x.value.forEach(a=>{const t=new Date(a.publishTime),s=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;e[s]||(e[s]=[]),e[s].push(a)});const a=Object.keys(e).sort((e,a)=>a.localeCompare(e)),t={};return a.forEach(a=>{t[a]=e[a].sort((e,a)=>new Date(a.publishTime).getTime()-new Date(e.publishTime).getTime())}),t});s(async()=>{await L(),q(),l(()=>{O.value=!0,q()}),n(()=>{O.value=!1,H()})}),c(()=>{H()});const q=()=>{H(),N.value=setInterval(async()=>{if(O.value){console.log("🔄 自动刷新数据...");try{const e=await $.getNews(!0);if(e.success&&e.data.length>0){const a=e.data||[];z.value=new Date(e.updateTime).getTime();(a.length>x.value.length||a.length>0&&x.value.length>0&&a[0].id!==x.value[0].id)&&(await Y(1,!0),o({title:"发现新内容",icon:"success",duration:1500}))}}catch(e){console.log("自动刷新失败:",e)}}},6e5)},H=()=>{N.value&&(clearInterval(N.value),N.value=null)},L=async()=>{try{await Promise.all([Y(),G()])}catch(e){console.error("初始化失败:",e),o({title:"初始化失败",icon:"error"})}},P=async()=>{console.log("🔄 刷新新闻数据..."),M.value=1,await Y(1,!0),await G(),o({title:"数据已更新",icon:"success",duration:2e3})},Y=async(e=1,a=!1)=>{1===e?(I.value=!0,x.value=[],M.value=1,E.value=!0):S.value=!0;try{console.log("📰 开始加载新闻数据...");const t=await $.getNews(a);if(!t.success)throw new Error(t.error||"加载失败");{const a=t.data||[];z.value=new Date(t.updateTime).getTime();const s=(e-1)*j.value,l=s+j.value,n=a.slice(s,l);x.value=1===e?n:[...x.value,...n],E.value=l<a.length,await J(),console.log(`✅ 成功加载 ${n.length} 条新闻，总计 ${x.value.length} 条`),1===e&&n.length>0&&o({title:`已加载 ${n.length} 条最新快讯`,icon:"success",duration:2e3})}}catch(t){console.error("❌ 加载新闻失败:",t),o({title:"加载失败，请稍后重试",icon:"error"})}finally{I.value=!1,S.value=!1}},G=async()=>{try{const e=await $.getNews();e.success&&(A.value=e.stats,console.log("📊 统计信息加载成功:",e.stats))}catch(e){console.error("❌ 加载统计失败:",e)}},J=async()=>{try{x.value.forEach(e=>{e.isFavorited=T.isFavorited(e.id)}),console.log("✅ 收藏状态加载成功")}catch(e){console.error("❌ 加载收藏状态失败:",e)}},K=()=>{D({url:"/pages/ai-news/search"})},Q=()=>{F({title:"关注公众号",content:"请在微信搜索并关注公众号「MaynorAI」，获取更多一手AI资讯和工具。",showCancel:!1})},R=e=>{const a=new Date(e),t=new Date,s=new Date(t.getTime()-864e5),l=a.getMonth()+1,n=a.getDate(),c=["周日","周一","周二","周三","周四","周五","周六"][a.getDay()];return e===t.toISOString().split("T")[0]?`今天·${c}`:e===s.toISOString().split("T")[0]?`昨天·${c}`:`${l}月${n}日·${c}`},U=e=>{if(!e)return"";const a=new Date(e);return`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`};return(e,a)=>{const t=i,s=h,l=d("uni-icons"),n=C;return f(),u(t,{class:"news-container"},{default:r(()=>[v(t,{class:"header-banner"},{default:r(()=>[v(t,{class:"banner-bg"},{default:r(()=>[v(t,{class:"banner-content"},{default:r(()=>[v(t,{class:"banner-icon"},{default:r(()=>[v(t,{class:"news-icon"},{default:r(()=>[_("📰")]),_:1})]),_:1}),v(t,{class:"banner-text"},{default:r(()=>[v(t,{class:"banner-title"},{default:r(()=>[_("每日AI快讯")]),_:1}),v(t,{class:"banner-subtitle"},{default:r(()=>[_("AI行业资讯 | 热点 | 融资 | 产品动态")]),_:1})]),_:1})]),_:1})]),_:1}),v(t,{class:"description"},{default:r(()=>[_(" AI工具集每日实时更新 AI 行业的最新资讯、新闻、热点、融资、产品动态、爆料等，让你随时了解人工智能领域最新趋势、更新突破和热门大事件。 "),v(s,{class:"highlight",onClick:Q},{default:r(()=>[_("关注公众号 MaynorAI")]),_:1}),_(" ，获取最新一手信息！ ")]),_:1})]),_:1}),v(t,{class:"search-section"},{default:r(()=>[v(t,{class:"search-box",onClick:K},{default:r(()=>[v(l,{type:"search",size:"16",color:"#999"}),v(s,{class:"search-placeholder"},{default:r(()=>[_("输入关键词搜索定位(精确匹配)")]),_:1})]),_:1})]),_:1}),A.value.totalCount>0?(f(),u(t,{key:0,class:"stats-section"},{default:r(()=>[v(t,{class:"stats-item"},{default:r(()=>[v(s,{class:"stats-number"},{default:r(()=>[_(w(A.value.totalCount),1)]),_:1}),v(s,{class:"stats-label"},{default:r(()=>[_("总快讯")]),_:1})]),_:1}),v(t,{class:"stats-item"},{default:r(()=>[v(s,{class:"stats-number"},{default:r(()=>[_(w(A.value.todayCount),1)]),_:1}),v(s,{class:"stats-label"},{default:r(()=>[_("今日新增")]),_:1})]),_:1}),v(t,{class:"stats-item"},{default:r(()=>[v(s,{class:"stats-number"},{default:r(()=>[_(w(Math.ceil((Date.now()-z.value)/1e3/60)),1)]),_:1}),v(s,{class:"stats-label"},{default:r(()=>[_("分钟前更新")]),_:1})]),_:1})]),_:1})):g("",!0),I.value&&0===x.value.length?(f(),u(t,{key:1,class:"loading-state"},{default:r(()=>[v(l,{type:"spinner-cycle",size:"30",color:"#4285F4"}),v(s,{class:"loading-text"},{default:r(()=>[_("正在加载最新快讯...")]),_:1})]),_:1})):g("",!0),!I.value||x.value.length>0?(f(),u(t,{key:2,class:"news-list"},{default:r(()=>[(f(!0),y(p,null,m(B.value,(e,a)=>(f(),u(t,{key:a,class:"date-group"},{default:r(()=>[v(t,{class:"date-header"},{default:r(()=>[v(t,{class:"date-indicator"}),v(s,{class:"date-text"},{default:r(()=>[_(w(R(a)),1)]),_:2},1024)]),_:2},1024),v(t,{class:"date-news-list"},{default:r(()=>[(f(!0),y(p,null,m(e,(e,a)=>(f(),u(t,{key:e.id,class:"news-item",onClick:a=>(e=>{D({url:`/pages/ai-news/news-detail?id=${e.id}`})})(e)},{default:r(()=>[v(t,{class:"news-content"},{default:r(()=>[v(t,{class:"news-title"},{default:r(()=>[_(w(e.title),1)]),_:2},1024),v(t,{class:"news-meta"},{default:r(()=>[v(s,{class:"news-source"},{default:r(()=>[_("来源："+w(e.source),1)]),_:2},1024),v(s,{class:"news-time"},{default:r(()=>[_(w(U(e.publishTime)),1)]),_:2},1024)]),_:2},1024),e.tags&&e.tags.length>0?(f(),u(t,{key:0,class:"news-tags"},{default:r(()=>[(f(!0),y(p,null,m(e.tags.slice(0,3),e=>(f(),u(s,{key:e,class:"news-tag"},{default:r(()=>[_(w(e),1)]),_:2},1024))),128))]),_:2},1024)):g("",!0)]),_:2},1024),v(t,{class:"news-actions"},{default:r(()=>[v(t,{class:k(["favorite-btn",{favorited:e.isFavorited}]),onClick:b(a=>(e=>{try{e.isFavorited?(T.removeFavorite(e.id),e.isFavorited=!1,o({title:"已取消收藏",icon:"success"})):(T.saveFavorite(e),e.isFavorited=!0,o({title:"已收藏",icon:"success"}))}catch(a){console.error("❌ 收藏操作失败:",a),o({title:"操作失败",icon:"error"})}})(e),["stop"])},{default:r(()=>[v(l,{type:e.isFavorited?"heart-filled":"heart",color:e.isFavorited?"#FF6B6B":"#CCC",size:"16"},null,8,["type","color"])]),_:2},1032,["class","onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):g("",!0),S.value?(f(),u(t,{key:3,class:"load-more"},{default:r(()=>[v(l,{type:"spinner-cycle",size:"20",color:"#4285F4"}),v(s,{class:"load-more-text"},{default:r(()=>[_("正在加载更多...")]),_:1})]),_:1})):g("",!0),!E.value&&x.value.length>0?(f(),u(t,{key:4,class:"no-more"},{default:r(()=>[v(s,{class:"no-more-text"},{default:r(()=>[_("— 已加载全部快讯 —")]),_:1})]),_:1})):g("",!0),I.value||0!==x.value.length?g("",!0):(f(),u(t,{key:5,class:"empty-state"},{default:r(()=>[v(l,{type:"info",size:"60",color:"#DDD"}),v(s,{class:"empty-text"},{default:r(()=>[_("暂无快讯数据")]),_:1}),v(n,{class:"refresh-btn",onClick:P},{default:r(()=>[_("刷新试试")]),_:1})]),_:1})),I.value?g("",!0):(f(),u(t,{key:6,class:"floating-refresh",onClick:P},{default:r(()=>[v(l,{type:"refresh",size:"20",color:"#4285F4"})]),_:1}))]),_:1})}}}),[["__scopeId","data-v-41631b36"]]);export{S as default};
