import{d as e,r as a,o as t,z as l,s,f as o,w as c,i as r,g as u,h as i,k as n,j as d,m as v,l as f,u as g,t as _,n as y,F as h,p,v as m,A as w,B as k,C as b,D as F}from"./index-DpT7KWJo.js";import{N as x,L as T,_ as $}from"./_plugin-vue_export-helper.Chd5Fyx7.js";const C=$(e({__name:"news-detail",setup(e){const $=a(!0),C=a(null),z=a([]),D=a("");t(async()=>{var e;const a=l(),t=a[a.length-1];D.value=(null==(e=t.options)?void 0:e.id)||"",D.value?await U():$.value=!1});const U=async()=>{$.value=!0;try{const e=await x.getNews();if(!e.success)throw new Error(e.error||"加载失败");{const a=e.data.find(e=>e.id===D.value);a&&(C.value=a,I(),M(e.data))}}catch(e){console.error("❌ 加载新闻详情失败:",e),s({title:"加载失败",icon:"error"})}finally{$.value=!1}},I=()=>{try{C.value.isFavorited=T.isFavorited(D.value)}catch(e){console.error("❌ 检查收藏状态失败:",e)}},M=e=>{try{let a=e.filter(e=>e.id!==D.value);if(C.value.tags&&C.value.tags.length>0&&(a=a.filter(e=>e.tags&&e.tags.some(e=>C.value.tags.includes(e)))),a.length<5){const t=e.filter(e=>e.id!==D.value&&e.category===C.value.category&&!a.some(a=>a.id===e.id));a=[...a,...t]}z.value=a.sort((e,a)=>new Date(a.publishTime).getTime()-new Date(e.publishTime).getTime()).slice(0,5),console.log(`✅ 找到 ${z.value.length} 条相关新闻`)}catch(a){console.error("❌ 加载相关新闻失败:",a)}},j=()=>{try{C.value.isFavorited?(T.removeFavorite(D.value),C.value.isFavorited=!1,s({title:"已取消收藏",icon:"success"})):(T.saveFavorite(C.value),C.value.isFavorited=!0,s({title:"已收藏",icon:"success"}))}catch(e){console.error("❌ 收藏操作失败:",e),s({title:"操作失败",icon:"error"})}},L=()=>{w({itemList:["复制链接","复制标题","分享给朋友"],success:e=>{0===e.tapIndex?k({data:C.value.sourceUrl||"暂无链接",success:()=>{s({title:"已复制链接",icon:"success"})}}):1===e.tapIndex?k({data:C.value.title,success:()=>{s({title:"已复制标题",icon:"success"})}}):2===e.tapIndex&&uni.share({title:C.value.title,summary:C.value.content,href:C.value.sourceUrl})}})},N=()=>{C.value.sourceUrl&&window.open(C.value.sourceUrl,"_blank")},A=()=>{F()},B=e=>{if(!e)return"";const a=new Date(e),t=(new Date).getTime()-a.getTime(),l=Math.floor(t/6e4),s=Math.floor(t/36e5),o=Math.floor(t/864e5);return l<60?`${l}分钟前`:s<24?`${s}小时前`:o<7?`${o}天前`:`${a.getFullYear()}年${a.getMonth()+1}月${a.getDate()}日`};return(e,a)=>{const t=u("uni-icons"),l=v,s=r,w=m;return i(),o(s,{class:"detail-container"},{default:c(()=>[$.value?(i(),o(s,{key:0,class:"loading-state"},{default:c(()=>[d(t,{type:"spinner-cycle",size:"30",color:"#007aff"}),d(l,{class:"loading-text"},{default:c(()=>[f("加载中...")]),_:1})]),_:1})):n("",!0),!$.value&&C.value?(i(),o(s,{key:1,class:"news-detail"},{default:c(()=>[d(s,{class:"news-header"},{default:c(()=>[d(s,{class:"category-time"},{default:c(()=>{return[d(s,{class:g(["news-category",(e=C.value.category,{"投融资":"category-finance","开源项目":"category-opensource","产品发布":"category-product","行业动态":"category-industry","技术研究":"category-tech","综合资讯":"category-general"}[e]||"category-default")])},{default:c(()=>[f(_(C.value.category),1)]),_:1},8,["class"]),d(l,{class:"news-time"},{default:c(()=>[f(_(B(C.value.publishTime)),1)]),_:1})];var e}),_:1}),d(s,{class:"news-source"},{default:c(()=>[d(l,null,{default:c(()=>[f("来源："+_(C.value.source),1)]),_:1})]),_:1})]),_:1}),d(s,{class:"news-title"},{default:c(()=>[f(_(C.value.title),1)]),_:1}),C.value.tags&&C.value.tags.length?(i(),o(s,{key:0,class:"news-tags"},{default:c(()=>[(i(!0),y(h,null,p(C.value.tags,e=>(i(),o(s,{key:e,class:"tag-item"},{default:c(()=>[f(_(e),1)]),_:2},1024))),128))]),_:1})):n("",!0),d(s,{class:"news-content"},{default:c(()=>[d(l,{class:"content-text"},{default:c(()=>[f(_(C.value.content),1)]),_:1})]),_:1}),C.value.sourceUrl?(i(),o(s,{key:1,class:"source-link",onClick:N},{default:c(()=>[d(t,{type:"link",size:"16",color:"#007aff"}),d(l,{class:"link-text"},{default:c(()=>[f("查看原文")]),_:1})]),_:1})):n("",!0),d(s,{class:"action-buttons"},{default:c(()=>[d(w,{class:g(["action-btn favorite-btn",{favorited:C.value.isFavorited}]),onClick:j},{default:c(()=>[d(t,{type:C.value.isFavorited?"heart-filled":"heart",size:"18",color:C.value.isFavorited?"#fff":"#007aff"},null,8,["type","color"]),d(l,null,{default:c(()=>[f(_(C.value.isFavorited?"已收藏":"收藏"),1)]),_:1})]),_:1},8,["class"]),d(w,{class:"action-btn share-btn",onClick:L},{default:c(()=>[d(t,{type:"redo",size:"18",color:"#007aff"}),d(l,null,{default:c(()=>[f("分享")]),_:1})]),_:1})]),_:1}),z.value.length>0?(i(),o(s,{key:2,class:"related-news"},{default:c(()=>[d(s,{class:"section-title"},{default:c(()=>[f("相关推荐")]),_:1}),(i(!0),y(h,null,p(z.value,(e,a)=>(i(),o(s,{key:e.id,class:"related-item",onClick:a=>(e=>{b({url:`/pages/ai-news/news-detail?id=${e.id}`})})(e)},{default:c(()=>[d(s,{class:"related-title"},{default:c(()=>[f(_(e.title),1)]),_:2},1024),d(s,{class:"related-meta"},{default:c(()=>[d(l,{class:"related-category"},{default:c(()=>[f(_(e.category),1)]),_:2},1024),d(l,{class:"related-time"},{default:c(()=>[f(_(B(e.publishTime)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):n("",!0)]),_:1})):n("",!0),$.value||C.value?n("",!0):(i(),o(s,{key:2,class:"error-state"},{default:c(()=>[d(t,{type:"info",size:"60",color:"#ddd"}),d(l,{class:"error-text"},{default:c(()=>[f("新闻不存在或已删除")]),_:1}),d(w,{class:"back-btn",onClick:A},{default:c(()=>[f("返回")]),_:1})]),_:1}))]),_:1})}}}),[["__scopeId","data-v-b2da23ae"]]);export{C as default};
