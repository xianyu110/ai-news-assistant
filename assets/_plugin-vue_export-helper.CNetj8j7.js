import{E as t,J as e,G as a,_ as r,H as o}from"./index-y3w81WhB.js";const s="/data/ai-news.json",c={key:"newsData",updateKey:"lastUpdateTime",expireTime:3e5};class i{static saveFavorite(t){try{const e=this.getFavorites();return!e.find(e=>e.id===t.id)&&(e.push({id:t.id,title:t.title,category:t.category,createTime:(new Date).toISOString()}),a("favorites",e),!0)}catch(e){return console.error("保存收藏失败:",e),!1}}static removeFavorite(t){try{const e=this.getFavorites().filter(e=>e.id!==t);return a("favorites",e),!0}catch(e){return console.error("移除收藏失败:",e),!1}}static getFavorites(){try{return t("favorites")||[]}catch(e){return console.error("获取收藏失败:",e),[]}}static isFavorited(t){try{return this.getFavorites().some(e=>e.id===t)}catch(e){return!1}}static saveSearchHistory(t){try{if(!t.trim())return;let e=this.getSearchHistory();e=e.filter(e=>e!==t),e.unshift(t),e.length>10&&(e=e.slice(0,10)),a("searchHistory",e)}catch(e){console.error("保存搜索历史失败:",e)}}static getSearchHistory(){try{return t("searchHistory")||[]}catch(e){return[]}}static clearSearchHistory(){try{o("searchHistory")}catch(t){console.error("清除搜索历史失败:",t)}}static isCacheExpired(){try{const e=t(c.updateKey);if(!e)return!0;const a=Date.now();return a>e+c.expireTime}catch(e){return!0}}static updateCacheTime(){try{a(c.updateKey,Date.now())}catch(t){console.error("更新缓存时间失败:",t)}}}class n{static async getNews(o=!1){try{console.log("🔄 开始获取新闻数据...",{forceRefresh:o});if(!(o||i.isCacheExpired())){const e=t(c.key);if(e)return console.log("📄 使用缓存数据"),e}try{console.log("🌐 尝试从本地路径获取最新数据...");const t=await e({url:s,method:"GET",timeout:1e4,header:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(200===t.statusCode&&t.data){console.log("✅ GitHub 数据获取成功");const e=this.processNewsData(t.data);return a(c.key,e),i.updateCacheTime(),e}}catch(n){console.warn("❌ GitHub 数据获取失败:",n)}try{console.log("📁 尝试导入本地数据...");const t=await r(()=>import("./data-ai-news.BZm0eQTO.js"),[]),e=t.default||t;if(e&&e.data&&Array.isArray(e.data)){console.log("✅ 本地数据导入成功");const t=this.processNewsData(e);return a(c.key,t),i.updateCacheTime(),t}}catch(n){console.warn("❌ 本地数据导入失败:",n)}try{console.log("🔗 尝试从本地路径获取数据...");const t=await e({url:s,method:"GET",timeout:8e3});if(200===t.statusCode&&t.data){console.log("✅ 本地路径数据获取成功");const e=this.processNewsData(t.data);return a(c.key,e),i.updateCacheTime(),e}}catch(n){console.warn("❌ 本地路径数据获取失败:",n)}const l=t(c.key);return l?(console.log("📄 使用旧缓存数据"),l):(console.log("⚠️ 使用默认数据"),this.getDefaultData())}catch(n){console.error("❌ 获取新闻数据失败:",n);const e=t(c.key);return e||this.getDefaultData()}}static processNewsData(t){const e=t.data||[],a=(new Date).toDateString(),r=e.filter(t=>new Date(t.publishTime).toDateString()===a).length,o=[...new Set(e.map(t=>t.category))],s=[...new Set(e.map(t=>t.source))];return{success:!0,updateTime:t.updateTime||(new Date).toISOString(),count:e.length,data:e,stats:{todayCount:r,totalCount:e.length,categories:o,sources:s}}}static async refreshNews(){return console.log("🔄 强制刷新新闻数据..."),this.getNews(!0)}static async searchNews(t,e){try{if(!e){e=(await this.getNews()).data}if(!t.trim())return e;const a=t.toLowerCase();return e.filter(t=>t.title.toLowerCase().includes(a)||t.content.toLowerCase().includes(a)||t.tags.some(t=>t.toLowerCase().includes(a))||t.source.toLowerCase().includes(a))}catch(a){return console.error("搜索新闻失败:",a),[]}}static filterByCategory(t,e){return"全部"===e?t:t.filter(t=>t.category===e)}static getDefaultData(){return{success:!0,updateTime:(new Date).toISOString(),count:5,data:[{id:"demo-1",title:"AI新闻助手数据加载中...",content:"正在从远程数据源获取最新AI资讯，请稍候...",originalContent:"正在从远程数据源获取最新AI资讯，请稍候...",source:"系统提示",sourceUrl:"https://ai-bot.cn/daily-ai-news/",publishTime:(new Date).toISOString(),crawlTime:(new Date).toISOString(),category:"系统消息",tags:["加载中"],dateText:"今日"},{id:"demo-2",title:"数据获取策略说明",content:"本应用会优先从 GitHub 获取最新数据，如果失败则使用本地缓存数据，确保在各种网络环境下都能正常访问。",originalContent:"本应用会优先从 GitHub 获取最新数据，如果失败则使用本地缓存数据，确保在各种网络环境下都能正常访问。",source:"系统说明",sourceUrl:"https://ai-bot.cn/daily-ai-news/",publishTime:(new Date).toISOString(),crawlTime:(new Date).toISOString(),category:"系统消息",tags:["说明"],dateText:"今日"}],stats:{todayCount:0,totalCount:2,categories:["系统消息"],sources:["系统提示","系统说明"]}}}}const l=(t,e)=>{const a=t.__vccOpts||t;for(const[r,o]of e)a[r]=o;return a};export{i as L,n as N,l as _};
