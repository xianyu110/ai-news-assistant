import{g as t,K as e,_ as a,J as r,y as o}from"./index-CqJPQCPW.js";const s="/data/ai-news.json",n={key:"newsData",updateKey:"lastUpdateTime",expireTime:12e4,lastDataHashKey:"lastDataHash"};class c{static saveFavorite(t){try{const e=this.getFavorites();return!e.find(e=>e.id===t.id)&&(e.push({id:t.id,title:t.title,category:t.category,createTime:(new Date).toISOString()}),r("favorites",e),!0)}catch(e){return console.error("保存收藏失败:",e),!1}}static removeFavorite(t){try{const e=this.getFavorites().filter(e=>e.id!==t);return r("favorites",e),!0}catch(e){return console.error("移除收藏失败:",e),!1}}static getFavorites(){try{return t("favorites")||[]}catch(e){return console.error("获取收藏失败:",e),[]}}static isFavorited(t){try{return this.getFavorites().some(e=>e.id===t)}catch(e){return!1}}static saveSearchHistory(t){try{if(!t.trim())return;let e=this.getSearchHistory();e=e.filter(e=>e!==t),e.unshift(t),e.length>10&&(e=e.slice(0,10)),r("searchHistory",e)}catch(e){console.error("保存搜索历史失败:",e)}}static getSearchHistory(){try{return t("searchHistory")||[]}catch(e){return[]}}static clearSearchHistory(){try{o("searchHistory")}catch(t){console.error("清除搜索历史失败:",t)}}static isCacheExpired(){try{const e=t(n.updateKey);if(!e)return!0;const a=Date.now();return a>e+n.expireTime}catch(e){return!0}}static updateCacheTime(){try{r(n.updateKey,Date.now())}catch(t){console.error("更新缓存时间失败:",t)}}static generateDataHash(t){var e,a,r,o,s,n;try{const c=JSON.stringify({count:t.count||0,updateTime:t.updateTime,firstItemId:null==(a=null==(e=t.data)?void 0:e[0])?void 0:a.id,lastItemId:null==(s=null==(o=t.data)?void 0:o[(null==(r=t.data)?void 0:r.length)-1])?void 0:s.id,dataLength:(null==(n=t.data)?void 0:n.length)||0});let i=0;for(let t=0;t<c.length;t++){i=(i<<5)-i+c.charCodeAt(t),i&=i}return i.toString()}catch(c){return""}}static hasDataChanged(e){try{const a=this.generateDataHash(e),o=t(n.lastDataHashKey);return(!o||o!==a)&&(r(n.lastDataHashKey,a),!0)}catch(a){return console.error("检查数据变化失败:",a),!0}}}class i{static async getNews(o=!1){try{console.log("🔄 开始获取新闻数据...",{forceRefresh:o});if(!(o||c.isCacheExpired())){const e=t(n.key);if(e)return console.log("📄 使用缓存数据"),e}let l=null;try{console.log("🌐 尝试从本地路径获取最新数据...");const t=await e({url:s,method:"GET",timeout:8e3,header:{"Cache-Control":"no-cache",Pragma:"no-cache","If-None-Match":""}});200===t.statusCode&&t.data&&(console.log("✅ GitHub 数据获取成功"),l=t.data)}catch(i){console.warn("❌ GitHub 数据获取失败:",i)}if(!l)try{console.log("📁 尝试导入本地数据...");const t=await a(()=>import("./data-ai-news.B7nFrgcY.js"),[]);l=t.default||t,console.log("✅ 本地数据导入成功")}catch(i){console.warn("❌ 本地数据导入失败:",i)}if(!l)try{console.log("🔗 尝试从本地路径获取数据...");const t=await e({url:s,method:"GET",timeout:5e3});200===t.statusCode&&t.data&&(console.log("✅ 本地路径数据获取成功"),l=t.data)}catch(i){console.warn("❌ 本地路径数据获取失败:",i)}if(l&&l.data&&Array.isArray(l.data)){const t=this.processNewsData(l);return c.hasDataChanged(l)&&console.log("🆕 检测到数据变化，更新缓存"),r(n.key,t),c.updateCacheTime(),t}const u=t(n.key);return u?(console.log("📄 使用旧缓存数据"),u):(console.log("⚠️ 使用默认数据"),this.getDefaultData())}catch(i){console.error("❌ 获取新闻数据失败:",i);const e=t(n.key);return e||this.getDefaultData()}}static processNewsData(t){const e=t.data||[],a=(new Date).toDateString(),r=e.filter(t=>new Date(t.publishTime).toDateString()===a).length,o=[...new Set(e.map(t=>t.category))],s=[...new Set(e.map(t=>t.source))];return{success:!0,updateTime:t.updateTime||(new Date).toISOString(),count:e.length,data:e,stats:{todayCount:r,totalCount:e.length,categories:o,sources:s}}}static async refreshNews(){return console.log("🔄 强制刷新新闻数据..."),this.getNews(!0)}static async searchNews(t,e){try{if(!e){e=(await this.getNews()).data}if(!t.trim())return e;const a=t.toLowerCase();return e.filter(t=>t.title.toLowerCase().includes(a)||t.content.toLowerCase().includes(a)||t.tags.some(t=>t.toLowerCase().includes(a))||t.source.toLowerCase().includes(a))}catch(a){return console.error("搜索新闻失败:",a),[]}}static filterByCategory(t,e){return"全部"===e?t:t.filter(t=>t.category===e)}static getDefaultData(){return{success:!0,updateTime:(new Date).toISOString(),count:5,data:[{id:"demo-1",title:"AI新闻助手数据加载中...",content:"正在从远程数据源获取最新AI资讯，请稍候...",originalContent:"正在从远程数据源获取最新AI资讯，请稍候...",source:"系统提示",sourceUrl:"https://ai-bot.cn/daily-ai-news/",publishTime:(new Date).toISOString(),crawlTime:(new Date).toISOString(),category:"系统消息",tags:["加载中"],dateText:"今日"},{id:"demo-2",title:"数据获取策略说明",content:"本应用会优先从 GitHub 获取最新数据，如果失败则使用本地缓存数据，确保在各种网络环境下都能正常访问。",originalContent:"本应用会优先从 GitHub 获取最新数据，如果失败则使用本地缓存数据，确保在各种网络环境下都能正常访问。",source:"系统说明",sourceUrl:"https://ai-bot.cn/daily-ai-news/",publishTime:(new Date).toISOString(),crawlTime:(new Date).toISOString(),category:"系统消息",tags:["说明"],dateText:"今日"}],stats:{todayCount:0,totalCount:2,categories:["系统消息"],sources:["系统提示","系统说明"]}}}}const l=(t,e)=>{const a=t.__vccOpts||t;for(const[r,o]of e)a[r]=o;return a};export{c as L,i as N,l as _};
